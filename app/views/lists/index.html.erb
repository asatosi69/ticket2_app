<%# 左から　トリオ、ペア、通常 %>


<div class="table-responsive">
  <table class="table table-striped table-bordered table-hover" style="table-layout:fixed;width:75%">
    <tr>
      <td  style="width: 120px">
      </td>
      <% @stages.each do |stage| %>
        <th>
          <p class="text-center">
          <%= stage.stage %>
          </p>
        </th>
      <% end %>
      <th align="center">
        <p class="text-center">
          集計
        </p>
      </th>
    </tr>

    <% @sellers.each do |seller| %>
      <tr>
        <th align="center">
          <p class="text-center">
            <%= seller.name %>
          </p>
        </th>
        <% @stages.each do |stage| %>
          <td align="center">
          <% array = [] %>
          <% sum = 0 %>
          <% @kinds.each do |kind| %>
            <%# 予約枚数 %>
            <% @seats_count = Ticket.ticket_list_classified_by_seller(seller.id, stage.id, kind.id) %>
            <% sum += @seats_count * kind.seats %>
            <% array.push(@seats_count) %>
          <% end %>
          <%= sum %>
          <% array.each do |value| %>
            (<%= value %>)
          <% end %>
          </td>
        <% end %>
        <%# 合計(取扱者別)処理 %>
        <td align="center">
          <% array = [] %>
          <% sum = 0 %>
          <% @kinds.each do |kind| %>
            <% @seats_count = Ticket.tickets_of_the_seller(seller.id, kind.id) %>
            <% sum += @seats_count * kind.seats %>
            <% array.push(@seats_count) %>
          <% end %>
          <%= sum %>
          <% array.each do |value| %>
            (<%= value %>)
          <% end %>
        </td>
      </tr>
    <% end %>


    <tr>
      <th align="center">
        <p class="text-center">
          販売済
        </p>
      </th>
      <%# 合計(公演別)処理 %>
      <% @stages.each do |stage| %>
        <td align="center">
          <% array = [] %>
          <% sum = 0 %>
          <% @kinds.each do |kind| %>
            <% @seats_count = Ticket.tickets_in_the_stage(stage.id, kind.id) %>
            <% sum += @seats_count * kind.seats %>
            <% array.push(@seats_count) %>
          <% end %>
          <%= sum %>
          <% array.each do |value| %>
            (<%= value %>)
          <% end %>
        </td>
      <% end %>
      <%# 総合計処理 %>
      <td align="center">
        <% array = [] %>
        <% sum2 = 0 %>
        <% @kinds.each do |kind| %>
          <% @seats_count = Ticket.all_tickets(kind.id) %>
          <% sum2 += @seats_count * kind.seats%>
          <% array.push(@seats_count) %>
        <% end %>
        <%= sum2 %>
        <% array.each do |value| %>
          (<%= value %>)
        <% end %>
      </td>
    </tr>


    <%# 空行 %>
    <tr>
      <td>
      </td>
      <% @stages.each do |stage| %>
        <td>
        </td>
      <% end %>
      <td>
      </td>
    </tr>

    <tr>
      <th align="center">
        <p class="text-center">
          座席
        </p>
      </th>
      <% sum3 = 0 %>
      <% @stages.each do |stage| %>
      <td align="center">
        <%= stage.total_seats %>
        <% sum3 += stage.total_seats %>
      </td>
      <% end %>
      <td align="center">
        <%= sum3 %>
      </td>
    </tr>


    <tr>
      <th align="center">
        <p class="text-center">
          収容率(%)
        </p>
      </th>
      <% @stages.each do |stage| %>
        <td align="center">
        <% array = [] %>
        <% sum = 0 %>
        <% @kinds.each do |kind| %>
          <% @seats_count = Ticket.tickets_in_the_stage(stage.id, kind.id) %>
          <% sum += @seats_count * kind.seats%>
        <% end %>
        <%= sum * 100 / stage.total_seats   %>
      </td>
      <% end %>
      <td align="center">
        <%= sum2 * 100 / sum3   %>
      </td>
    </tr>


    <%# 空行 %>
    <tr>
      <td>
      </td>
      <% @stages.each do |stage| %>
        <td>
        </td>
      <% end %>
      <td>
      </td>
    </tr>

    <tr>
      <th align="center">
        <p class="text-center">
          金額
        </p>
      </th>
      <% @stages.each do |stage| %>
        <td align="center">
        <% sum = 0 %>
        <% @kinds.each do |kind| %>
          <% @seats_count = Ticket.tickets_in_the_stage(stage.id, kind.id) %>
          <% sum += @seats_count * kind.price %>
        <% end %>
        <%= sum %>
        </td>
      <% end %>
      <td align="center">
        <% sum2 = 0 %>
        <% @kinds.each do |kind| %>
          <% @seats_count = Ticket.all_tickets(kind.id) %>
          <% sum2 += @seats_count * kind.price %>
        <% end %>
        <%= sum2 %>
      </td>
    </tr>





  </table>
</div>
